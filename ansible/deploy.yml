- hosts: 35.192.54.163 
  roles: 
    - common
    - docker
  vars:
    backend_image: liujordan/reliable-blog:backend-1.0.0
    frontend_image: liujordan/reliable-blog:frontend-1.0.0
    host_name: deployingreliable.software
  tasks:
    - name: Copy compose file
      template:
        src: ./roles/shared-files/compose/docker-compose.prod.yml.j2
        dest: /opt/reliable/docker/docker-compose.yml
      become: yes
    - name: Copy configs
      copy:
        src: ./roles/shared-files/config
        dest: /opt/reliable/docker/config
      become: yes
    # TODO Add certs to host and use docker_compose instead of shell command
    - name: Run compose
      shell: 
        chdir: /opt/reliable/docker
        cmd: docker-compose up -d && docker-compose exec backend rake db:migrate

