- hosts: 35.192.54.163 
  roles: 
    - common
    - docker
  vars:
    backend_image: docker.pkg.github.com/choyiny/reliable_blog/reliable-blog-backend:34398645b9d0
    frontend_image: docker.pkg.github.com/choyiny/reliable_blog/reliable-blog-frontend:34398645b9d0
    host_name: deployingreliable.software
  tasks:
    - name: Copy compose file
      template:
        src: ./roles/shared-files/compose/docker-compose.prod.yml.j2
        dest: /opt/reliable/docker/docker-compose.yml
      become: yes
    - name: Copy configs
      copy:
        src: ./roles/shared-files/config
        dest: /opt/reliable/docker/config
      become: yes
    # TODO Add certs to host and use docker_compose instead of shell command
    - name: Run compose
      shell: 
        chdir: /opt/reliable/docker
        cmd: docker-compose up -d && docker-compose exec backend rake db:migrate

